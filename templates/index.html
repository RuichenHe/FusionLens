<!DOCTYPE html>
<html>
<head>
    <title>Image Gallery</title>
    <link rel="stylesheet" type="text/css" href="{{url_for('static', filename='css/style.css')}}">
</head>
<body>
    <h1>Stable Diffusion Visualizer</h1>
    <button id="generateButton">Generate Images</button>
    <button id="addRegionButton">Add Prompt</button>
    <div class="container">
        <textarea class="promptInput" placeholder="Enter your prompt here..."></textarea>
        <div class="imageGallery"></div>
    </div>
    <script>
        document.getElementById('generateButton').addEventListener('click', function() {
            document.querySelectorAll('.container:not(.used)').forEach(function(container) {
                const prompt = container.querySelector('.promptInput').value;
                const imageGallery = container.querySelector('.imageGallery');
                const tsnePlot = container.querySelector('.tsnePlot');  // Container for the t-SNE plot


                // Mark the container as used
                container.classList.add('used');

                fetch('/api/generate', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({ prompt: prompt }),
                })
                .then(response => response.json())
                .then(data => {
                    imageGallery.innerHTML = ''; // Clear the gallery
                    tsnePlot.innerHTML = ''; // Clear the t-SNE plot container
                    data.images.forEach(imageSrc => {
                        const img = document.createElement('img');
                        img.src = imageSrc;
                        img.classList.add('image');
                        imageGallery.appendChild(img);
                    });
                    // Display t-SNE plot
                    const tsneImage = document.createElement('img');
                    tsneImage.src = data.tsne_plot;
                    tsneImage.classList.add('tsne-image');
                    tsnePlot.appendChild(tsneImage);

                })
                .catch(error => {
                    console.error('Error:', error);
                });
            });
        });
    
    
    document.getElementById('addRegionButton').addEventListener('click', function() {
        // Create a new container div
        const newContainer = document.createElement('div');
        newContainer.classList.add('container');

        // Assign a unique ID to the container (optional, if you want to target it specifically later)
        newContainer.id = 'container-' + document.querySelectorAll('.container').length;

        // Create a new textarea
        const newTextArea = document.createElement('textarea');
        newTextArea.classList.add('promptInput');
        newTextArea.placeholder = 'Enter your prompt here...';

        // Create a new image gallery div
        const newImageGallery = document.createElement('div');
        newImageGallery.classList.add('imageGallery');


        // Create a new t-SNE plot div
        const newTsnePlot = document.createElement('div');
        newTsnePlot.classList.add('tsnePlot');
        newTsnePlot.style.width = '100%'; // Optional: Set width to full container width
        newTsnePlot.style.textAlign = 'center'; // Optional: Center-align the content

        // Create a delete button
        const deleteButton = document.createElement('button');
        deleteButton.textContent = 'Delete';
        deleteButton.classList.add('deleteButton');

        // Add event listener to the delete button
        deleteButton.addEventListener('click', function() {
            newContainer.remove();
        });

        // Append the textarea, image gallery, and delete button to the container
        newContainer.appendChild(newTextArea);
        newContainer.appendChild(newImageGallery);
        newContainer.appendChild(newTsnePlot);
        newContainer.appendChild(deleteButton);

        // Append the new container to the body (or to a specific parent element)
        document.body.appendChild(newContainer);
    });
    
    </script>
</body>
</html>


